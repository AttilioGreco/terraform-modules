module "mysql" {
  source = "github.com/entercloudsuite/terraform-modules//mysql-orchestrator-db?ref=2.7-devel"
  name = "${var.name}"
  quantity = "${var.quantity}"
  external = "${var.external}"
  network_name = "${var.network_name}"
  sec_group = "${var.sec_group}"
  keypair = "${var.keypair}"
  private_ssh_key = "${var.private_ssh_key}"
  flavor = "${var.mysql_flavor}"
  discovery = "true"
  mysql_port = "${var.mysql_port}"
  mysql_datadir = "${var.mysql_datadir}"
  mysql_admin_name = "${var.mysql_admin_name}"
  mysql_admin_password = "${var.mysql_admin_password}"
  mysql_replica_user_name = "${var.mysql_replica_user_name}"
  mysql_replica_user_password = "${var.mysql_replica_user_password}"
  mysql_volume_size = "${var.mysql_volume_size}"
  mysql_volume_type = "${var.mysql_volume_type}"
  consul = "${var.consul}"
  consul_port = "${var.consul_port}"
  consul_datacenter = "${var.consul_datacenter}"
  consul_encrypt = "${var.consul_encrypt}"
  orchestrator = "${var.name}-orchestrator.service.automium.consul"
  orchestrator_port = "${var.orchestrator_port}"
  orchestrator_user = "${var.orchestrator_user}"
  orchestrator_password = "${var.orchestrator_password}"
  orchestrator_cluster_name = "${var.name}"
}

module "orchestrator" {
  source = "github.com/entercloudsuite/terraform-modules//orchestrator?ref=2.7-devel"
  name = "${var.name}-orchestrator"
  quantity = "${var.orchestrator_quantity}"
  external = "${var.external}"
  network_name = "${var.network_name}"
  sec_group = "${var.sec_group}"
  keypair = "${var.keypair}"
  discovery = "true"
  orchestrator_port = "${var.orchestrator_port}" 
  orchestrator_user = "${var.orchestrator_user}" 
  orchestrator_password = "${var.orchestrator_password}" 
  orchestrator_authentication_method = "basic"
  orchestrator_http_auth_user = "${var.mysql_admin_name}"
  orchestrator_http_auth_password = "${var.mysql_admin_password}"
  orchestrator_raft_enabled = "true"
  orchestrator_raft_data_dir = "/var/lib/orchestrator" 
  orchestrator_raft_default_port = "${var.orchestrator_raft_default_port}"
  orchestrator_raft_nodes = "[ '${var.name}-orchestrator-0.node.${var.consul_datacenter}.consul', '${var.name}-orchestrator-1.node.${var.consul_datacenter}.consul', '${var.name}-orchestrator-2.node.${var.consul_datacenter}.consul' ]" 
  consul = "${var.consul}" 
  consul_port = "${var.consul_port}" 
  consul_datacenter = "${var.consul_datacenter}" 
  consul_encrypt = "${var.consul_encrypt}"
}
